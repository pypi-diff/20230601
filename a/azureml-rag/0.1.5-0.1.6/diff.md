# Comparing `tmp/azureml_rag-0.1.5-py3-none-any.whl.zip` & `tmp/azureml_rag-0.1.6-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,59 +1,60 @@
-Zip file size: 169364 bytes, number of entries: 57
--rw-rw-rw-  2.0 fat      246 b- defN 23-May-22 06:18 azureml/rag/__init__.py
--rw-rw-rw-  2.0 fat    39993 b- defN 23-May-22 06:18 azureml/rag/documents.py
--rw-rw-rw-  2.0 fat    29244 b- defN 23-May-22 06:18 azureml/rag/embeddings.py
--rw-rw-rw-  2.0 fat     5058 b- defN 23-May-22 06:18 azureml/rag/mlindex.py
--rw-rw-rw-  2.0 fat     4149 b- defN 23-May-22 06:18 azureml/rag/models.py
--rw-rw-rw-  2.0 fat     4646 b- defN 23-May-22 06:19 azureml/rag/_asset_client/client.py
--rw-rw-rw-  2.0 fat      893 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/__init__.py
--rw-rw-rw-  2.0 fat     4381 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/_azure_machine_learning_workspaces.py
--rw-rw-rw-  2.0 fat     3538 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/_configuration.py
--rw-rw-rw-  2.0 fat     1561 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/_patch.py
--rw-rw-rw-  2.0 fat      495 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/_version.py
--rw-rw-rw-  2.0 fat      399 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/models.py
--rw-rw-rw-  2.0 fat      957 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/dataset/__init__.py
--rw-rw-rw-  2.0 fat     3802 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/dataset/_azure_machine_learning_workspaces.py
--rw-rw-rw-  2.0 fat     3144 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/dataset/_configuration.py
--rw-rw-rw-  2.0 fat      694 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/dataset/_patch.py
--rw-rw-rw-  2.0 fat    81019 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/dataset/_serialization.py
--rw-rw-rw-  2.0 fat     1833 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/dataset/_vendor.py
--rw-rw-rw-  2.0 fat      495 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/dataset/_version.py
--rw-rw-rw-  2.0 fat     6787 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/dataset/models/__init__.py
--rw-rw-rw-  2.0 fat     4635 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/dataset/models/_azure_machine_learning_workspaces_enums.py
--rw-rw-rw-  2.0 fat   131448 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/dataset/models/_models_py3.py
--rw-rw-rw-  2.0 fat      694 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/dataset/models/_patch.py
--rw-rw-rw-  2.0 fat      585 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/dataset/operations/__init__.py
--rw-rw-rw-  2.0 fat   104636 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/dataset/operations/_data_version_operations.py
--rw-rw-rw-  2.0 fat    80785 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/dataset/operations/_mlindex_operations.py
--rw-rw-rw-  2.0 fat      893 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/runhistory/__init__.py
--rw-rw-rw-  2.0 fat     3902 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/runhistory/_azure_machine_learning_workspaces.py
--rw-rw-rw-  2.0 fat     3226 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/runhistory/_configuration.py
--rw-rw-rw-  2.0 fat     1561 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/runhistory/_patch.py
--rw-rw-rw-  2.0 fat     1255 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/runhistory/_vendor.py
--rw-rw-rw-  2.0 fat      495 b- defN 23-May-22 06:20 azureml/rag/_asset_client/_restclient/runhistory/_version.py
--rw-rw-rw-  2.0 fat    11705 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/runhistory/models/__init__.py
--rw-rw-rw-  2.0 fat     2566 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/runhistory/models/_azure_machine_learning_workspaces_enums.py
--rw-rw-rw-  2.0 fat   175170 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/runhistory/models/_models.py
--rw-rw-rw-  2.0 fat   188776 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/runhistory/models/_models_py3.py
--rw-rw-rw-  2.0 fat      563 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/runhistory/operations/__init__.py
--rw-rw-rw-  2.0 fat   162796 b- defN 23-May-22 06:21 azureml/rag/_asset_client/_restclient/runhistory/operations/_runs_operations.py
--rw-rw-rw-  2.0 fat    10785 b- defN 23-May-22 06:19 azureml/rag/langchain/acs.py
--rw-rw-rw-  2.0 fat      183 b- defN 23-May-22 06:19 azureml/rag/tasks/__init__.py
--rw-rw-rw-  2.0 fat     2094 b- defN 23-May-22 06:19 azureml/rag/tasks/build_faiss.py
--rw-rw-rw-  2.0 fat     7544 b- defN 23-May-22 06:19 azureml/rag/tasks/crack_and_chunk.py
--rw-rw-rw-  2.0 fat     7330 b- defN 23-May-22 06:19 azureml/rag/tasks/embed.py
--rw-rw-rw-  2.0 fat     6328 b- defN 23-May-22 06:19 azureml/rag/tasks/embed_prs.py
--rw-rw-rw-  2.0 fat     2340 b- defN 23-May-22 06:19 azureml/rag/tasks/git_clone.py
--rw-rw-rw-  2.0 fat     3002 b- defN 23-May-22 06:19 azureml/rag/tasks/register_mlindex.py
--rw-rw-rw-  2.0 fat    18964 b- defN 23-May-22 06:19 azureml/rag/tasks/update_acs.py
--rw-rw-rw-  2.0 fat      208 b- defN 23-May-22 06:19 azureml/rag/utils/__init__.py
--rw-rw-rw-  2.0 fat     1588 b- defN 23-May-22 06:19 azureml/rag/utils/azureml.py
--rw-rw-rw-  2.0 fat     7435 b- defN 23-May-22 06:19 azureml/rag/utils/connections.py
--rw-rw-rw-  2.0 fat     2350 b- defN 23-May-22 06:19 azureml/rag/utils/git.py
--rw-rw-rw-  2.0 fat     8529 b- defN 23-May-22 06:19 azureml/rag/utils/logging.py
--rw-rw-rw-  2.0 fat     1021 b- defN 23-May-22 06:25 azureml_rag-0.1.5.dist-info/LICENSE.txt
--rw-rw-rw-  2.0 fat     5365 b- defN 23-May-22 06:25 azureml_rag-0.1.5.dist-info/METADATA
--rw-rw-rw-  2.0 fat       97 b- defN 23-May-22 06:25 azureml_rag-0.1.5.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        8 b- defN 23-May-22 06:25 azureml_rag-0.1.5.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     6063 b- defN 23-May-22 06:25 azureml_rag-0.1.5.dist-info/RECORD
-57 files, 1160259 bytes uncompressed, 159270 bytes compressed:  86.3%
+Zip file size: 170102 bytes, number of entries: 58
+-rw-rw-rw-  2.0 fat      246 b- defN 23-Jun-01 06:13 azureml/rag/__init__.py
+-rw-rw-rw-  2.0 fat    39881 b- defN 23-Jun-01 06:13 azureml/rag/documents.py
+-rw-rw-rw-  2.0 fat    29244 b- defN 23-Jun-01 06:13 azureml/rag/embeddings.py
+-rw-rw-rw-  2.0 fat     5058 b- defN 23-Jun-01 06:13 azureml/rag/mlindex.py
+-rw-rw-rw-  2.0 fat     4149 b- defN 23-Jun-01 06:13 azureml/rag/models.py
+-rw-rw-rw-  2.0 fat     4646 b- defN 23-Jun-01 06:14 azureml/rag/_asset_client/client.py
+-rw-rw-rw-  2.0 fat      893 b- defN 23-Jun-01 06:15 azureml/rag/_asset_client/_restclient/__init__.py
+-rw-rw-rw-  2.0 fat     4381 b- defN 23-Jun-01 06:15 azureml/rag/_asset_client/_restclient/_azure_machine_learning_workspaces.py
+-rw-rw-rw-  2.0 fat     3538 b- defN 23-Jun-01 06:15 azureml/rag/_asset_client/_restclient/_configuration.py
+-rw-rw-rw-  2.0 fat     1561 b- defN 23-Jun-01 06:15 azureml/rag/_asset_client/_restclient/_patch.py
+-rw-rw-rw-  2.0 fat      495 b- defN 23-Jun-01 06:15 azureml/rag/_asset_client/_restclient/_version.py
+-rw-rw-rw-  2.0 fat      399 b- defN 23-Jun-01 06:15 azureml/rag/_asset_client/_restclient/models.py
+-rw-rw-rw-  2.0 fat      957 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/__init__.py
+-rw-rw-rw-  2.0 fat     3802 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/_azure_machine_learning_workspaces.py
+-rw-rw-rw-  2.0 fat     3144 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/_configuration.py
+-rw-rw-rw-  2.0 fat      694 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/_patch.py
+-rw-rw-rw-  2.0 fat    81019 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/_serialization.py
+-rw-rw-rw-  2.0 fat     1833 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/_vendor.py
+-rw-rw-rw-  2.0 fat      495 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/_version.py
+-rw-rw-rw-  2.0 fat     6787 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/models/__init__.py
+-rw-rw-rw-  2.0 fat     4635 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/models/_azure_machine_learning_workspaces_enums.py
+-rw-rw-rw-  2.0 fat   131448 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/models/_models_py3.py
+-rw-rw-rw-  2.0 fat      694 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/models/_patch.py
+-rw-rw-rw-  2.0 fat      585 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/operations/__init__.py
+-rw-rw-rw-  2.0 fat   104636 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/operations/_data_version_operations.py
+-rw-rw-rw-  2.0 fat    80785 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/dataset/operations/_mlindex_operations.py
+-rw-rw-rw-  2.0 fat      893 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/runhistory/__init__.py
+-rw-rw-rw-  2.0 fat     3902 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/runhistory/_azure_machine_learning_workspaces.py
+-rw-rw-rw-  2.0 fat     3226 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/runhistory/_configuration.py
+-rw-rw-rw-  2.0 fat     1561 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/runhistory/_patch.py
+-rw-rw-rw-  2.0 fat     1255 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/runhistory/_vendor.py
+-rw-rw-rw-  2.0 fat      495 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/runhistory/_version.py
+-rw-rw-rw-  2.0 fat    11705 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/runhistory/models/__init__.py
+-rw-rw-rw-  2.0 fat     2566 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/runhistory/models/_azure_machine_learning_workspaces_enums.py
+-rw-rw-rw-  2.0 fat   175170 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/runhistory/models/_models.py
+-rw-rw-rw-  2.0 fat   188776 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/runhistory/models/_models_py3.py
+-rw-rw-rw-  2.0 fat      563 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/runhistory/operations/__init__.py
+-rw-rw-rw-  2.0 fat   162796 b- defN 23-Jun-01 06:16 azureml/rag/_asset_client/_restclient/runhistory/operations/_runs_operations.py
+-rw-rw-rw-  2.0 fat    10785 b- defN 23-Jun-01 06:14 azureml/rag/langchain/acs.py
+-rw-rw-rw-  2.0 fat      183 b- defN 23-Jun-01 06:14 azureml/rag/tasks/__init__.py
+-rw-rw-rw-  2.0 fat     2318 b- defN 23-Jun-01 06:14 azureml/rag/tasks/build_faiss.py
+-rw-rw-rw-  2.0 fat     7945 b- defN 23-Jun-01 06:14 azureml/rag/tasks/crack_and_chunk.py
+-rw-rw-rw-  2.0 fat     7502 b- defN 23-Jun-01 06:14 azureml/rag/tasks/embed.py
+-rw-rw-rw-  2.0 fat     6328 b- defN 23-Jun-01 06:14 azureml/rag/tasks/embed_prs.py
+-rw-rw-rw-  2.0 fat     2340 b- defN 23-Jun-01 06:14 azureml/rag/tasks/git_clone.py
+-rw-rw-rw-  2.0 fat     3002 b- defN 23-Jun-01 06:14 azureml/rag/tasks/register_mlindex.py
+-rw-rw-rw-  2.0 fat    19067 b- defN 23-Jun-01 06:14 azureml/rag/tasks/update_acs.py
+-rw-rw-rw-  2.0 fat      208 b- defN 23-Jun-01 06:14 azureml/rag/utils/__init__.py
+-rw-rw-rw-  2.0 fat       98 b- defN 23-Jun-01 06:14 azureml/rag/utils/_telemetry.json
+-rw-rw-rw-  2.0 fat     1588 b- defN 23-Jun-01 06:14 azureml/rag/utils/azureml.py
+-rw-rw-rw-  2.0 fat     7435 b- defN 23-Jun-01 06:14 azureml/rag/utils/connections.py
+-rw-rw-rw-  2.0 fat     2634 b- defN 23-Jun-01 06:14 azureml/rag/utils/git.py
+-rw-rw-rw-  2.0 fat     8529 b- defN 23-Jun-01 06:14 azureml/rag/utils/logging.py
+-rw-rw-rw-  2.0 fat     1021 b- defN 23-Jun-01 06:21 azureml_rag-0.1.6.dist-info/LICENSE.txt
+-rw-rw-rw-  2.0 fat     5572 b- defN 23-Jun-01 06:21 azureml_rag-0.1.6.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       97 b- defN 23-Jun-01 06:21 azureml_rag-0.1.6.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        8 b- defN 23-Jun-01 06:21 azureml_rag-0.1.6.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat     6151 b- defN 23-Jun-01 06:21 azureml_rag-0.1.6.dist-info/RECORD
+58 files, 1161724 bytes uncompressed, 159866 bytes compressed:  86.2%
```

## zipnote {}

```diff
@@ -138,35 +138,38 @@
 
 Filename: azureml/rag/tasks/update_acs.py
 Comment: 
 
 Filename: azureml/rag/utils/__init__.py
 Comment: 
 
+Filename: azureml/rag/utils/_telemetry.json
+Comment: 
+
 Filename: azureml/rag/utils/azureml.py
 Comment: 
 
 Filename: azureml/rag/utils/connections.py
 Comment: 
 
 Filename: azureml/rag/utils/git.py
 Comment: 
 
 Filename: azureml/rag/utils/logging.py
 Comment: 
 
-Filename: azureml_rag-0.1.5.dist-info/LICENSE.txt
+Filename: azureml_rag-0.1.6.dist-info/LICENSE.txt
 Comment: 
 
-Filename: azureml_rag-0.1.5.dist-info/METADATA
+Filename: azureml_rag-0.1.6.dist-info/METADATA
 Comment: 
 
-Filename: azureml_rag-0.1.5.dist-info/WHEEL
+Filename: azureml_rag-0.1.6.dist-info/WHEEL
 Comment: 
 
-Filename: azureml_rag-0.1.5.dist-info/top_level.txt
+Filename: azureml_rag-0.1.6.dist-info/top_level.txt
 Comment: 
 
-Filename: azureml_rag-0.1.5.dist-info/RECORD
+Filename: azureml_rag-0.1.6.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## azureml/rag/documents.py

```diff
@@ -312,19 +312,17 @@
         from langchain.text_splitter import TokenTextSplitter
         return TokenTextSplitter(**arguments)
     elif file_extension == ".html" or file_extension == ".htm":
         from langchain.text_splitter import TokenTextSplitter
         return TokenTextSplitter(**arguments)
     elif file_extension == ".md":
         if use_rcts:
-            logger.info('Using MarkdownTextSplitter')
             from langchain.text_splitter import MarkdownTextSplitter
             return MarkdownTextSplitter.from_tiktoken_encoder(**arguments)
         else:
-            logger.info('Using MarkdownHeaderSplitter')
             return MarkdownHeaderSplitter.from_tiktoken_encoder(remove_hyperlinks=True, remove_images=True, **arguments)
     else:
         raise ValueError(f"Invalid file_extension: {file_extension}")
 
 
 file_extension_splitters = {
     ".txt": lambda **kwargs: get_langchain_splitter(".txt", kwargs),
```

## azureml/rag/tasks/build_faiss.py

```diff
@@ -2,15 +2,16 @@
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # ---------------------------------------------------------
 """File for building FAISS Indexes."""
 import os
 from pathlib import Path
 
 from azureml.rag.embeddings import Embeddings
-from azureml.rag.utils.logging import get_logger, enable_stdout_logging
+from azureml.rag.utils.logging import get_logger, enable_stdout_logging, enable_appinsights_logging, track_activity
+
 
 logger = get_logger('build_faiss')
 
 
 if __name__ == '__main__':
     from argparse import ArgumentParser
 
@@ -18,14 +19,15 @@
     parser.add_argument("--embeddings", type=str)
     parser.add_argument("--output", type=str)
     args = parser.parse_args()
 
     print('\n'.join(f'{k}={v}' for k, v in vars(args).items()))
 
     enable_stdout_logging()
+    enable_appinsights_logging()
 
     raw_embeddings_uri = args.embeddings
     logger.info(f'got embeddings uri as input: {raw_embeddings_uri}', extra={'print': True})
     splits = raw_embeddings_uri.split('/')
     embeddings_dir_name = splits.pop(len(splits)-2)
     logger.info(f'extracted embeddings directory name: {embeddings_dir_name}', extra={'print': True})
     parent = '/'.join(splits)
@@ -38,10 +40,11 @@
     mnt_options = MountOptions(
         default_permission=0o555, allow_other=False, read_only=True)
     logger.info(f'mounting embeddings container from: \n{parent} \n   to: \n{os.getcwd()}/raw_embeddings', extra={'print': True})
     with rslex_uri_volume_mount(parent, f'{os.getcwd()}/raw_embeddings', options=mnt_options) as mount_context:
         logger.info("Loading Embeddings", extra={'print': True})
         emb = Embeddings.load(embeddings_dir_name, mount_context.mount_point)
 
-        emb.write_as_faiss_mlindex(Path(args.output))
+        with track_activity(logger, 'update_acs', custom_dimensions={'num_embeddings': len(emb._document_embeddings)}) as activity_logger:
+            emb.write_as_faiss_mlindex(Path(args.output))
 
     logger.info('Generated FAISS index', extra={'print': True})
```

## azureml/rag/tasks/crack_and_chunk.py

```diff
@@ -35,14 +35,23 @@
 def write_chunks_to_csv(chunks_df, output_path):
     output_dir = Path(output_path).parent
     output_dir.mkdir(parents=True, exist_ok=True)
 
     chunks_df.to_csv(output_path, index=False)
 
 
+def str2bool(v):
+    if isinstance(v, bool):
+        return v
+    if v.lower() in ('yes', 'true', 't', 'y', '1'):
+        return True
+    elif v.lower() in ('no', 'false', 'f', 'n', '0'):
+        return False
+
+
 if __name__ == '__main__':
     import argparse
 
     parser = argparse.ArgumentParser()
     parser.add_argument("--input_data", type=str)
     parser.add_argument("--input_glob", type=str, default="**/*")
     parser.add_argument("--allowed_extensions", required=False, type=str, default=",".join(SUPPORTED_EXTENSIONS))
@@ -53,25 +62,22 @@
     parser.add_argument("--data_source_url", type=str, required=False)
     parser.add_argument("--document_path_replacement_regex", type=str, required=False)
     parser.add_argument("--max_sample_files", type=int, default=-1)
     parser.add_argument("--include_summary", type=str, default="False")
     parser.add_argument("--summary_model_config", type=str, default='{"type": "azure_open_ai", "model_name": "gpt-35-turbo", "deployment_name": "gpt-35-turbo"}')
     parser.add_argument("--openai_api_version", type=str, default='2023-03-15-preview')
     parser.add_argument("--openai_api_type", type=str, default=None)
-    parser.add_argument("--use_rcts", type=bool, default=True)
+    parser.add_argument("--use_rcts", type=str2bool, default=True)
 
     args = parser.parse_args()
     print('\n'.join(f'{k}={v}' for k, v in vars(args).items()))
 
     enable_stdout_logging()
     enable_appinsights_logging()
 
-    # Get all files in directory, recursively
-    files = Path(args.input_data).rglob(args.input_glob)
-
     summary_model_config = None
     include_summary = (args.include_summary == "True" or args.include_summary == "true")
     if include_summary:
         import json
 
         try:
             summary_model_config = json.loads(args.summary_model_config)
@@ -97,15 +103,15 @@
             openai.api_version = summary_model_config["api_version"]
             openai.api_type = summary_model_config["api_type"]
             openai.api_base = summary_model_config["api_base"]
             openai.api_key = summary_model_config["key"]
 
     splitter_args = {'chunk_size': args.chunk_size, 'chunk_overlap': args.chunk_overlap, 'use_rcts': args.use_rcts}
 
-    with track_activity(logger, 'crack_and_chunk', {**splitter_args}) as activity_logger:
+    with track_activity(logger, 'crack_and_chunk', custom_dimensions={**splitter_args}) as activity_logger:
         chunked_documents = DocumentChunksIterator(
             files_source=args.input_data,
             glob=args.input_glob,
             base_url=args.data_source_url,
             document_path_replacement_regex=args.document_path_replacement_regex,
             chunked_document_processors = [lambda docs: split_documents(docs, splitter_args=splitter_args)],
         )
@@ -116,14 +122,18 @@
             # TODO: Ideally make it easy to limit number of files with a `- take: n` operation on input URI in MLTable
             if (args.max_sample_files != -1 and file_count >= args.max_sample_files):
                 logger.info(f"file count: {file_count} - reached max sample file count: {args.max_sample_files}", extra={'print': True})
                 break
             write_chunks_to_csv(chunks_to_dataframe(document.chunks), Path(args.output_title_chunk) / f"Chunks_{Path(document.source.filename).name}.csv")
         logger.info(f"Processed {file_count} files", extra={'print': True})
 
+        if file_count == 0:
+            logger.info(f"No files found in {args.input_data} with glob {args.input_glob}", extra={'print': True})
+            raise ValueError(f"No files found in {args.input_data} with glob {args.input_glob}, no chunks produced.")
+
         file_count = 0
         if include_summary:
             chunked_documents = DocumentChunksIterator(
                 files_source=args.input_data,
                 glob=args.input_glob,
                 base_url=args.data_source_url,
                 document_path_replacement_regex=args.document_path_replacement_regex,
```

## azureml/rag/tasks/embed.py

```diff
@@ -39,15 +39,17 @@
 
 def read_chunks_into_documents(files: Iterator[pathlib.Path]):
     # Append to list of texts and corresponding metadata
     file_max_chunk_len = 0
     for chunk_file in files:
         file_name = chunk_file.name
         logger.info(f'processing chunks for: {file_name}', extra={'print': True})
-        chunks_df = pd.read_csv(chunk_file)
+        # Ensure Chunk data is read as string even if it looks like another datatype.
+        dtype = {'Chunk': str, 'Metadata': str}
+        chunks_df = pd.read_csv(chunk_file, dtype=dtype, keep_default_na=False)
         chunks_dict = chunks_df.to_dict()
         max_chunk_len = 0
         for chunk_idx, chunk in chunks_dict["Chunk"].items():
             metadata = chunks_dict["Metadata"][chunk_idx]
             metadata_dict = json.loads(metadata)
             max_chunk_len = max(max_chunk_len, len(chunk))
             yield StaticDocument(metadata_dict['source']['filename'] + str(chunk_idx), chunk, metadata_dict, metadata_dict['source'].get('mtime'))
```

## azureml/rag/tasks/update_acs.py

```diff
@@ -197,30 +197,30 @@
         logger.error(f"Request failed: {e}\nResponse: {e.response.text}")
         raise e
 
     return response.json()['value']
 
 
 def create_index_from_raw_embeddings(emb: Embeddings, acs_config={}, connection={}, output_path: Optional[str] = None):
-    with track_activity(logger, 'update_acs', {'num_embeddings': len(emb._document_embeddings)}) as activity_logger:
+    with track_activity(logger, 'update_acs', custom_dimensions={'num_embeddings': len(emb._document_embeddings)}) as activity_logger:
         logger.info("Updating ACS index", extra={'print': True})
 
         credential = get_connection_credential(connection)
 
-        if str(acs_config.get('push_embeddings')).lower() == "true":
-            create_search_index_rest(acs_config, credential, emb)
-
-            def upload_docs_batch(batch):
-                return upload_documents_rest(acs_config, credential, batch)
-        else:
+        if str(acs_config.get('push_embeddings')).lower() == "false":
             create_search_index_sdk(acs_config, credential)
             search_client = search_client_from_config(acs_config, credential)
 
             def upload_docs_batch(batch):
                 return search_client.upload_documents(documents=batch)
+        else:
+            create_search_index_rest(acs_config, credential, emb)
+
+            def upload_docs_batch(batch):
+                return upload_documents_rest(acs_config, credential, batch)
 
         batch_size = acs_config['batch_size'] if 'batch_size' in acs_config else 100
 
         def process_upload_results(results, start_time):
             succeeded = []
             failed = []
             for r in results:
@@ -260,15 +260,17 @@
                 "sourcepage": emb_doc.metadata.get("source", {}).get("url"),
                 "sourcefile": emb_doc.metadata.get("source", {}).get("filename"),
                 "title": emb_doc.metadata.get("source", {}).get("title"),
                 "content_hash": emb_doc.document_hash,
                 "meta_json_string": json.dumps(emb_doc.metadata),
             }
 
-            if str(acs_config.get('push_embeddings')).lower() == "true":
+            if str(acs_config.get('push_embeddings')).lower() == "false":
+                pass
+            else:
                 acs_doc[f"content_vector_{emb.kind}"] = emb_doc.get_embeddings()
 
             batch.append(acs_doc)
             if len(batch) % batch_size == 0:
                 logger.info(f"Sending {len(batch)} documents to ACS", extra={'print': True})
                 start_time = time.time()
                 results = upload_docs_batch(batch)
@@ -316,15 +318,17 @@
                     "content": "content",
                     "url": "sourcepage",
                     "filename": "sourcefile",
                     "title": "title",
                     "metadata": "meta_json_string",
                 }
             }
-            if str(acs_config.get('push_embeddings')).lower() == "true":
+            if str(acs_config.get('push_embeddings')).lower() == "false":
+                pass
+            else:
                 mlindex_config["index"]["field_mapping"]["embedding"] = f"content_vector_{emb.kind}"
 
             if not isinstance(connection, DefaultAzureCredential):
                 mlindex_config["index"] = {**mlindex_config["index"], **connection}
 
             # Keyvault auth and Default ambient auth need the endpoint, Workspace Connection auth could get endpoint.
             mlindex_config["index"]["endpoint"] = acs_config['endpoint']
```

## azureml/rag/utils/git.py

```diff
@@ -40,15 +40,24 @@
     """Clone a git repository to a local path, optionally checking out a branch"""
     logger.info(f'Cloning {git_url} to {local_path}')
 
     if authentication is not None:
         git_url = git_url.replace('https://', f'https://{authentication["username"]}:{authentication["password"]}@')
 
     logger.info(f'Cloning with depth={1 if branch is None else None}')
-    repo = git.Repo.clone_from(git_url, local_path, progress=GitCloneProgress(), depth=1 if branch is None else None)
+    try:
+        repo = git.Repo.clone_from(git_url, local_path, progress=GitCloneProgress(), depth=1 if branch is None else None)
+    except git.exc.GitError as e:
+        logger.error(f'Failed to clone to {local_path}\ngit stdout: {e.stdout}\ngit stderr: {e.stderr}')
+
+        raise e
+    except Exception as e:
+        logger.error(f'Failed to clone to {local_path}: {e}')
+
+        raise e
     if branch is not None:
         logger.info('fetch --all')
         repo.git.fetch("--all")
         logger.info(f'checkout {branch}')
         repo.git.checkout(branch)
 
     logger.info(f'Cloned branch "{repo.active_branch}" at commit: {repo.head.commit.hexsha}')
```

## Comparing `azureml_rag-0.1.5.dist-info/LICENSE.txt` & `azureml_rag-0.1.6.dist-info/LICENSE.txt`

 * *Files identical despite different names*

## Comparing `azureml_rag-0.1.5.dist-info/METADATA` & `azureml_rag-0.1.6.dist-info/METADATA`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: azureml-rag
-Version: 0.1.5
+Version: 0.1.6
 Summary: Contains Retrieval Augmented Generation related utilities for Azure Machine Learning and OSS interoperability.
 Home-page: https://docs.microsoft.com/python/api/overview/azure/ml/?view=azure-ml-py
 Author: Microsoft Corporation
 License: Proprietary https://aka.ms/azureml-preview-sdk-license 
 Platform: UNKNOWN
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
@@ -117,14 +117,19 @@
 retriever = MLIndex(uri_to_folder_with_mlindex).as_langchain_retriever()
 retriever.get_relevant_documents('What is an AzureML Compute Instance?')
 ```
 
 
 # Changelog
 
+## 0.1.6 (2023-05-31)
+
+- Fail crack_and_chunk task when no files were processed (usually because of a malformed `input_glob`)
+- Change `update_acs.py` to default `push_embeddings=True` instead of `False`.
+
 ## 0.1.5 (2023-05-19)
 
 - Add api_base back to MLIndex embeddings config for back-compat (until all clients start getting it from Workspace Connection).
 - Add telemetry for tasks used in pipeline components, not enabled by default for SDK usage.
 
 ## 0.1.4 (2023-05-17)
 
@@ -137,11 +142,12 @@
 ## 0.1.2 (2023-05-05)
 
 - Refactored document chunking to allow insertion of custom processing logic
 
 ## 0.0.1 (2023-04-25)
 
 ### Features Added
+
 - Introduced package
 - langchain Retriever for Azure Cognitive Search
```

## Comparing `azureml_rag-0.1.5.dist-info/RECORD` & `azureml_rag-0.1.6.dist-info/RECORD`

 * *Files 5% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 azureml/rag/__init__.py,sha256=zgRl-az58He0no_ZUWab0AuVQSOTmgCLlfwbEcnwKS0,246
-azureml/rag/documents.py,sha256=QgTx5P8xtBRb4OgplPlx_sB2_f3ObfeVCvqs76A18ZE,39993
+azureml/rag/documents.py,sha256=PTxrleeRwsp_fQd7wCNpNWbtGSh5PBGNCyw97If7bUE,39881
 azureml/rag/embeddings.py,sha256=PgirYai7PmQkborZlyVLCNJe4oXkNq525Dpetj7XBN0,29244
 azureml/rag/mlindex.py,sha256=DNb-Z15nTzjmGZH5h0RGjqxQRvnIDg756W8gJDbObhA,5058
 azureml/rag/models.py,sha256=Ga9tvV0FsVhXprEeWpPVakNJ9q96byc0OjDESqkMuCw,4149
 azureml/rag/_asset_client/client.py,sha256=LpsDsedlQRxytezdvnxx1zfEQUb9DcYDY6RfkRSlXT0,4646
 azureml/rag/_asset_client/_restclient/__init__.py,sha256=38lKUIqL59KqhES7ZGBUGcrELWICWet0VFLxwY4W0fo,893
 azureml/rag/_asset_client/_restclient/_azure_machine_learning_workspaces.py,sha256=7XqTcSuvXHcKXu4FE71E4rBQAQ4Fmpdq8SXrhU7_AAg,4381
 azureml/rag/_asset_client/_restclient/_configuration.py,sha256=E52K3BmA4ZqAE6oP5VjRK32HsBrl6W9Y1oOsWCJu8Ig,3538
@@ -34,24 +34,25 @@
 azureml/rag/_asset_client/_restclient/runhistory/models/_azure_machine_learning_workspaces_enums.py,sha256=cyvWolLt_kCOalE8BvtnI_msfmAAlTYzdob0QDp1KZ0,2566
 azureml/rag/_asset_client/_restclient/runhistory/models/_models.py,sha256=CqQccTVrcm5_9uBZOJ6AMubF9K8GphuIzmF1j46G84Q,175170
 azureml/rag/_asset_client/_restclient/runhistory/models/_models_py3.py,sha256=G5x7IlIzWN98TsXpY80M5nyLjXIwBWWeL9Fk6Piwpzw,188776
 azureml/rag/_asset_client/_restclient/runhistory/operations/__init__.py,sha256=FFrjEyJdO53e7YDI8o_8W9BgTTEVt1ZzS8FwwnNp7-g,563
 azureml/rag/_asset_client/_restclient/runhistory/operations/_runs_operations.py,sha256=1nl-ETYrSQSZH3B-a2QXTKIUCx-Hx3XeQPmgAwKSGoA,162796
 azureml/rag/langchain/acs.py,sha256=xyJ5u7RlZ8FUVAQZg7z4LJv5pXACddLcRLihUL6sEQI,10785
 azureml/rag/tasks/__init__.py,sha256=JlCCObuOLZyNhIZlsoL51KtFxiY4xKIIzIRDBcdeu6Y,183
-azureml/rag/tasks/build_faiss.py,sha256=dXETVJJT77PGrav6OiUBzve5EjqOutNcD5cpP1vIHxU,2094
-azureml/rag/tasks/crack_and_chunk.py,sha256=vqLCHcJGmUuv1pLdT9L1CrO-yiT5MXF3LiOLwsKBX8c,7544
-azureml/rag/tasks/embed.py,sha256=yr_PnSq1a-BLh7EX7TvIVeusk2iD4Udw-xXlvpiCCI0,7330
+azureml/rag/tasks/build_faiss.py,sha256=9qJFbSVgnbP-87j1lmBhUeZUrfZpe_NLPulYPijYQS0,2318
+azureml/rag/tasks/crack_and_chunk.py,sha256=wYnzd_lvcE9w63NTjyOt-fsirvr2wWJqH-SLFUqiFtk,7945
+azureml/rag/tasks/embed.py,sha256=gCjmL9-CG3ygpwxDZX1_8MtfnUwYGMHWnb1kicwPsAQ,7502
 azureml/rag/tasks/embed_prs.py,sha256=DkK9I2kT1qIetgYGo-Bx6fPrDDbe3RrFJdVHrVadPGM,6328
 azureml/rag/tasks/git_clone.py,sha256=L7-gEP5r24AAq-aLxomURtDL7qfuWpusoRC9cm6iBjc,2340
 azureml/rag/tasks/register_mlindex.py,sha256=Gu2KUsyFBTfl0O_PxMOFNU-ROz-EinqowG_kkoiWxqY,3002
-azureml/rag/tasks/update_acs.py,sha256=ta42cSvBakCZNt7RTvKpAh0zxRo4WJJW-Y4KOwBKDp8,18964
+azureml/rag/tasks/update_acs.py,sha256=S-HJD-dzUr-K51m3fuovOgcDKgt_htQ5m3JvXeGVfhI,19067
 azureml/rag/utils/__init__.py,sha256=FTY5BaTKeythd7R1SXsf3midWHdshZj-bdFZLmZ7J50,208
+azureml/rag/utils/_telemetry.json,sha256=VlnC81iHUOx9NYj_BNpMzI2Y8Q3D8z832w31TQl9qI4,98
 azureml/rag/utils/azureml.py,sha256=dOfvDTgqjTWHg-I9Ho7_o6e7I8kNcVJdl53O0Ts7xQs,1588
 azureml/rag/utils/connections.py,sha256=zInLr6twjfHW4fF2zgChtNSI7YqnxY3eOVnu74xpq-Y,7435
-azureml/rag/utils/git.py,sha256=C_79CuCdBNLrid1eUf2nruPynpIgghbf9d9ArnpI_Wc,2350
+azureml/rag/utils/git.py,sha256=oumlex0PWWt8ppmL-0Sxli6cpRWpBR9THR0fqN2thFo,2634
 azureml/rag/utils/logging.py,sha256=0pnj9K8j7KC7IlJmu-HIDZETW1JKiWT2PjEzscycdis,8529
-azureml_rag-0.1.5.dist-info/LICENSE.txt,sha256=FOfkEEz4uS7g278F9Rq12rqKF3lLyBUZhVpLetuZrTg,1021
-azureml_rag-0.1.5.dist-info/METADATA,sha256=94d1D-mbWpwjC5mT3oFYEgHmzbsOtw1dnD8HJwGsYmk,5365
-azureml_rag-0.1.5.dist-info/WHEEL,sha256=YUYzQ6UQdoqxXjimOitTqynltBCkwY6qlTfTh2IzqQU,97
-azureml_rag-0.1.5.dist-info/top_level.txt,sha256=ZOeEa0TAXo6i5wOjwBoqfIGEuxOcKuscGgNSpizqREY,8
-azureml_rag-0.1.5.dist-info/RECORD,,
+azureml_rag-0.1.6.dist-info/LICENSE.txt,sha256=FOfkEEz4uS7g278F9Rq12rqKF3lLyBUZhVpLetuZrTg,1021
+azureml_rag-0.1.6.dist-info/METADATA,sha256=EGM4mcLN3I4It4l3CJLAF87_3bhgBBmclzb0YlucFu8,5572
+azureml_rag-0.1.6.dist-info/WHEEL,sha256=YUYzQ6UQdoqxXjimOitTqynltBCkwY6qlTfTh2IzqQU,97
+azureml_rag-0.1.6.dist-info/top_level.txt,sha256=ZOeEa0TAXo6i5wOjwBoqfIGEuxOcKuscGgNSpizqREY,8
+azureml_rag-0.1.6.dist-info/RECORD,,
```

