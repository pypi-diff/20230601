# Comparing `tmp/crip-1.6.1-py3-none-any.whl.zip` & `tmp/crip-1.6.3-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,19 +1,19 @@
-Zip file size: 4727755 bytes, number of entries: 111
+Zip file size: 4728299 bytes, number of entries: 111
 -rw-rw-rw-  2.0 fat      666 b- defN 23-Mar-21 05:27 crip/__init__.py
 -rw-rw-rw-  2.0 fat      766 b- defN 23-Mar-21 05:27 crip/_typing.py
 -rw-rw-rw-  2.0 fat     4206 b- defN 23-Mar-21 05:42 crip/de.py
 -rw-rw-rw-  2.0 fat     8354 b- defN 23-Apr-30 23:30 crip/io.py
--rw-rw-rw-  2.0 fat     2622 b- defN 23-May-03 08:03 crip/lowdose.py
--rw-rw-rw-  2.0 fat    10973 b- defN 23-Apr-30 23:30 crip/mangoct.py
+-rw-rw-rw-  2.0 fat     2614 b- defN 23-May-18 15:00 crip/lowdose.py
+-rw-rw-rw-  2.0 fat    11032 b- defN 23-Jun-01 12:42 crip/mangoct.py
 -rw-rw-rw-  2.0 fat     1431 b- defN 23-Mar-21 05:41 crip/metric.py
--rw-rw-rw-  2.0 fat     2708 b- defN 23-May-01 01:15 crip/paplot.py
--rw-rw-rw-  2.0 fat    13451 b- defN 23-May-05 15:31 crip/physics.py
--rw-rw-rw-  2.0 fat     3789 b- defN 23-May-03 08:27 crip/postprocess.py
--rw-rw-rw-  2.0 fat     6653 b- defN 23-Mar-21 05:27 crip/preprocess.py
+-rw-rw-rw-  2.0 fat     2702 b- defN 23-May-18 15:00 crip/paplot.py
+-rw-rw-rw-  2.0 fat    13593 b- defN 23-May-18 15:00 crip/physics.py
+-rw-rw-rw-  2.0 fat     3724 b- defN 23-May-18 15:00 crip/postprocess.py
+-rw-rw-rw-  2.0 fat     8211 b- defN 23-May-18 17:19 crip/preprocess.py
 -rw-rw-rw-  2.0 fat     6678 b- defN 23-Mar-21 05:27 crip/shared.py
 -rw-rw-rw-  2.0 fat     5528 b- defN 23-May-03 08:10 crip/utils.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Mar-21 05:27 crip/_atten/__init__.py
 -rw-rw-rw-  2.0 fat     1304 b- defN 23-Mar-21 05:27 crip/_atten/_attenList.json
 -rw-rw-rw-  2.0 fat      548 b- defN 23-May-01 01:06 crip/_atten/_classicRho.json
 -rw-rw-rw-  2.0 fat      627 b- defN 23-Mar-21 05:27 crip/_atten/_updateList.py
 -rw-rw-rw-  2.0 fat      592 b- defN 23-Mar-21 05:27 crip/_atten/compound/CaF2.txt
@@ -101,13 +101,13 @@
 -rw-rw-rw-  2.0 fat      922 b- defN 23-Mar-21 05:27 crip/_atten/simple/Ni.txt
 -rw-rw-rw-  2.0 fat      823 b- defN 23-Mar-21 05:27 crip/_atten/simple/O.txt
 -rw-rw-rw-  2.0 fat      691 b- defN 23-Mar-21 05:27 crip/_atten/simple/P.txt
 -rw-rw-rw-  2.0 fat      691 b- defN 23-Mar-21 05:27 crip/_atten/simple/S.txt
 -rw-rw-rw-  2.0 fat      823 b- defN 23-Mar-21 05:27 crip/_atten/simple/Si.txt
 -rw-rw-rw-  2.0 fat      526 b- defN 23-Mar-21 05:27 crip/_atten/simple/Sn.txt
 -rw-rw-rw-  2.0 fat   652928 b- defN 23-Mar-21 05:27 crip/_atten/simple/Ti_ICRP.txt
--rw-rw-rw-  2.0 fat     1052 b- defN 23-May-06 01:14 crip-1.6.1.dist-info/LICENSE
--rw-rw-rw-  2.0 fat      526 b- defN 23-May-06 01:14 crip-1.6.1.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-May-06 01:14 crip-1.6.1.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        5 b- defN 23-May-06 01:14 crip-1.6.1.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     9154 b- defN 23-May-06 01:14 crip-1.6.1.dist-info/RECORD
-111 files, 12757740 bytes uncompressed, 4713475 bytes compressed:  63.1%
+-rw-rw-rw-  2.0 fat     1052 b- defN 23-Jun-01 12:43 crip-1.6.3.dist-info/LICENSE
+-rw-rw-rw-  2.0 fat      526 b- defN 23-Jun-01 12:43 crip-1.6.3.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Jun-01 12:43 crip-1.6.3.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        5 b- defN 23-Jun-01 12:42 crip-1.6.3.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat     9154 b- defN 23-Jun-01 12:43 crip-1.6.3.dist-info/RECORD
+111 files, 12759420 bytes uncompressed, 4714019 bytes compressed:  63.1%
```

## zipnote {}

```diff
@@ -312,23 +312,23 @@
 
 Filename: crip/_atten/simple/Sn.txt
 Comment: 
 
 Filename: crip/_atten/simple/Ti_ICRP.txt
 Comment: 
 
-Filename: crip-1.6.1.dist-info/LICENSE
+Filename: crip-1.6.3.dist-info/LICENSE
 Comment: 
 
-Filename: crip-1.6.1.dist-info/METADATA
+Filename: crip-1.6.3.dist-info/METADATA
 Comment: 
 
-Filename: crip-1.6.1.dist-info/WHEEL
+Filename: crip-1.6.3.dist-info/WHEEL
 Comment: 
 
-Filename: crip-1.6.1.dist-info/top_level.txt
+Filename: crip-1.6.3.dist-info/top_level.txt
 Comment: 
 
-Filename: crip-1.6.1.dist-info/RECORD
+Filename: crip-1.6.3.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## crip/lowdose.py

```diff
@@ -43,18 +43,18 @@
     img = projections
     cripAssert(is2or3D(img), '`projections` should be 2D or 3D.')
 
     if type_ == 'postlog':
         img = np.exp(-projections)
 
     img = img * nPhoton  # N0 exp(-\sum \mu L)
-    
+
     cripAssert(np.min(img >= 0), '`img` should not contain negative values.')
     cripWarning(isIntType(img), '`img` should have int dtype. It will be floored after rescaling.')
-    
+
     img = np.random.poisson(img.astype(np.uint32)).astype(DefaultFloatDType)
     img[img <= 0] = 1
     img /= nPhoton
 
     if type_ == 'postlog':
         img = -np.log(img)
```

## crip/mangoct.py

```diff
@@ -222,35 +222,34 @@
 class _Mgbin(object):
     def __init__(self, exe: str, name: str, cudaDevice: int = 0, tempDir: str = None):
         self.exe = exe
         self.name = name
         self.cudaDevice = cudaDevice
         self.tempDir = tempDir
         self.cmd = []
-        self._buildCmd()
-
-    def _buildCmd(self):
         self.cmd.append([f'{self.exe}', '<1>'])
 
-    def exec(self, conf: Or[str, _MgConfig]):
+    def exec(self, conf: Or[str, _MgConfig], verbose=True):
         if isType(conf, _MgConfig):
             tmp = tempfile.NamedTemporaryFile('w',
                                               prefix='crip_mangoct_',
                                               suffix=f'.{self.name}.jsonc',
                                               dir=self.tempDir,
                                               delete=False)
             tmp.write(conf.dumpJSON())
             conf = tmp.name
             tmp.close()
 
         os.environ['CUDA_VISIBLE_DEVICES'] = str(self.cudaDevice)
+        stdout = stderr = None if verbose else subprocess.DEVNULL
+
         for cmd in self.cmd:
             if len(cmd) == 2:  # include args
                 cmd[1] = cmd[1].replace('<1>', conf)
-                subprocess.run(cmd)
+                subprocess.run(cmd, stdout=stdout, stderr=stderr)
             else:
                 os.system(cmd[0])
 
 
 class Mgfbp(_Mgbin):
     def __init__(self, exe: str = 'mgfbp', cudaDevice: int = 0, tempDir: str = None):
         '''
```

## crip/paplot.py

```diff
@@ -6,15 +6,15 @@
     https://github.com/z0gSh1u/crip
 '''
 
 import cv2
 import numpy as np
 from matplotlib import font_manager
 from ._typing import *
-from .utils import cripAssert, is1D, is2D, isInt
+from .utils import cripAssert, is1D, isInt
 
 __all__ = ['smooth', 'window', 'average', 'addFont', 'fontdict', 'zoomIn']
 
 
 def smooth(data: NDArray, winSize: int = 5):
     '''
         Smooth an 1D array by moving averaging window. This name follows MATLAB.
```

## crip/physics.py

```diff
@@ -22,15 +22,14 @@
 
 ## Constants ##
 
 DiagEnergyLow = 0  # keV
 DiagEnergyHigh = 150  # keV
 DiagEnergyRange = range(DiagEnergyLow, DiagEnergyHigh + 1)  # [low, high)
 DiagEnergyLen = DiagEnergyHigh - DiagEnergyLow + 1
-ForwardStartMinEnergy = 20  # keV
 AttenAliases = {
     'Gold': 'Au',
     'Carbon': 'C',
     'Copper': 'Cu',
     'Iodine': 'I',
     'H2O': 'Water',
     'Gadolinium': 'Gd',
@@ -114,19 +113,24 @@
 
         omega[startEnergy:cutOffEnergy + 1] = specOmega[:]
 
         return Spectrum(omega, unit)
 
     @staticmethod
     def fromFile(path: str, unit='keV'):
-        with open(path, 'r') as fp:
-            spec = fp.read()
+        spec = readFileText(path)
 
         return Spectrum.fromText(spec, unit)
 
+    @staticmethod
+    def monochromatic(at: int, unit='keV', omega=10**5):
+        text = '{} {}\n{} -1'.format(str(at), str(omega), str(at + 1))
+
+        return Spectrum.fromText(text, unit)
+
 
 class Atten:
     '''
         Parse atten text as `Atten` class object. Interpolation is performed to fill `DiagEnergyRange`.
 
         Refer to the document for atten text format (NIST ASCII or ICRP). @see https://github.com/z0gSh1u/crip
 
@@ -204,30 +208,33 @@
         content = np.array(list(map(procAttenLine, content)), dtype=DefaultFloatDType)
 
         energy, muDivRho = content.T
         energy = cvtEnergyUnit(energy, energyUnit, DefaultEnergyUnit)  # keV
 
         # perform log-domain interpolation to fill in `DiagEnergyRange`
         interpEnergy = np.log(DiagEnergyRange[1:])  # avoid log(0)
-        # interpF = interpolate.interp1d(np.log(energy), np.log(muDivRho), kind='linear', assume_sorted=False)
-        # interpMuDivRho = interpF(interpEnergy)
         interpMuDivRho = np.interp(interpEnergy, np.log(energy), np.log(muDivRho))
 
-
         # now we have mu for every energy in `DiagEnergyRange`.
         mu = np.exp(interpMuDivRho) * rho  # cm-1
         mu = cvtMuUnit(mu, 'cm-1', DefaultMuUnit)  # mm-1
         mu = np.insert(mu, 0, 0, axis=0)  # prepend energy = 0
 
         return Atten(mu, rho)
 
     @staticmethod
     def fromMuArray(muArray: NDArray, rho: Or[float, None] = None):
         return Atten(muArray, rho)
 
+    @staticmethod
+    def fromFile(path: str, rho: float, energyUnit='MeV'):
+        atten = readFileText(path)
+
+        return Atten.fromText(atten, rho, energyUnit)
+
 
 Material = Atten
 WaterAtten = Atten.fromBuiltIn('Water')
 
 
 def calcMu(atten: Atten, spec: Spectrum, energyConversion: Or[str, float, int, Callable]) -> float:
     '''
```

## crip/postprocess.py

```diff
@@ -109,16 +109,14 @@
 
 
 @ConvertListNDArray
 def huNoRescale(image: TwoOrThreeD, b: float = -1000, k: float = 1) -> TwoOrThreeD:
     '''
         Invert the rescale-slope (y = kx + b) of HU value to get linear relationship between HU and mu.
     '''
-    cripAssert(is2or3D(image), '`image` should be 2D or 3D.')
-
     return (image - b) / k
 
 
 def postlogsToProjections(postlogs: TwoOrThreeD, flat: Or[TwoD, float]) -> TwoOrThreeD:
     '''
         Invert postlog images to the original projections.
     '''
```

## crip/preprocess.py

```diff
@@ -2,18 +2,23 @@
     Preprocess module of crip.
 
     https://github.com/z0gSh1u/crip
 '''
 
 __all__ = [
     'averageProjections', 'flatDarkFieldCorrection', 'projectionsToSinograms', 'sinogramsToProjections', 'padImage',
-    'padSinogram', 'correctBeamHardeningPolynomial', 'injectGaussianNoise', 'injectPoissonNoise', 'binning'
+    'padSinogram', 'correctBeamHardeningPolynomial', 'injectGaussianNoise', 'injectPoissonNoise', 'binning', 'fan2para'
 ]
 
 import numpy as np
+import warnings
+
+warnings.simplefilter("ignore", DeprecationWarning)
+
+from scipy.interpolate import interp2d
 from .shared import *
 from ._typing import *
 from .utils import *
 from .lowdose import injectGaussianNoise, injectPoissonNoise
 
 
 @ConvertListNDArray
@@ -172,7 +177,48 @@
     cripWarning(isType(coeffs, np.poly1d) and bias is False, 'When using np.poly1d as coeffs, bias is always True.')
 
     if isType(coeffs, Tuple):
         if bias is False:
             coeffs = np.poly1d([*coeffs, 0])
 
     return coeffs(postlog)
+
+
+def fan2para(sgm, gammas, betas, d, oThetas, oLines):
+    '''
+        Re-order Fan-Beam sinogram to Parallel-Beam's.
+        gammas: the fan angles from min to max
+        betas: the rotation angles from min to max
+        d: Source-Isocenter-Distance
+        oThetas: output rotation angle [min, delta, max]
+        oLines: output detector element physical locs [min, delta, max]
+    '''
+    nThetas = np.round((oThetas[2] - oThetas[0]) / oThetas[1]).astype(np.int32)
+    nLines = np.round((oLines[2] - oLines[0]) / oLines[1]).astype(np.int32)
+
+    thetas1 = np.linspace(oThetas[0], oThetas[2], nThetas).reshape((1, -1))
+    R1 = np.linspace(oLines[0], oLines[2], nLines).reshape((1, -1))
+
+    thetas = thetas1.T @ np.ones((1, nLines))
+    Rs = np.ones((nThetas, 1)) @ R1
+
+    oGammas = np.arcsin(Rs / d)
+    oBetas = thetas + oGammas - np.pi / 2
+
+    minBetas, maxBetas = np.min(betas), np.max(betas)
+    inds = oBetas > maxBetas
+    if len(inds) > 0:
+        oBetas[inds] = oBetas[inds] - 2 * np.pi
+    inds = oBetas < minBetas
+    if len(inds) > 0:
+        oBetas[inds] = oBetas[inds] + 2 * np.pi
+    oBetas = np.minimum(oBetas, maxBetas)
+
+    func = interp2d(gammas, betas, sgm, 'linear', fill_value=0)
+
+    h, w = oGammas.shape
+    out = np.zeros_like(oGammas)
+    for i in range(h):
+        for j in range(w):
+            out[i, j] = func(oGammas[i, j], oBetas[i, j])
+
+    return out
```

## Comparing `crip-1.6.1.dist-info/LICENSE` & `crip-1.6.3.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `crip-1.6.1.dist-info/METADATA` & `crip-1.6.3.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: crip
-Version: 1.6.1
+Version: 1.6.3
 Summary: An all-in-one tool for Cone-Beam CT Data IO, Pre/Post-process, and Physics, Dual Energy, Low Dose researches and everything only except Reconstruction.
 Home-page: https://github.com/z0gSh1u/crip
 Author: z0gSh1u, CandleHouse
 Author-email: zx.cs@qq.com
 License: MIT License
 License-File: LICENSE
 Requires-Dist: numpy
```

## Comparing `crip-1.6.1.dist-info/RECORD` & `crip-1.6.3.dist-info/RECORD`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,18 @@
 crip/__init__.py,sha256=B-awW9Ni0TKwyoV70QStnJuefmwln_tn4Fi4_ppwxcE,666
 crip/_typing.py,sha256=df0QD0r2RAYxOC_LiNNVAa8FTzyu18ktsgyBQZ0MN_Y,766
 crip/de.py,sha256=1fTxw0hFdB6Uew9qopnzvvvYTgZYfRbJ4a-9cW_eEMQ,4206
 crip/io.py,sha256=9WCp6A4F6HT3QXUITxzj10NFnEjbMXYi_hczPPOQZ50,8354
-crip/lowdose.py,sha256=ojT8wi2fAcEREP6vp0XKfQ3CxodhTRT-xass3RbDUVo,2622
-crip/mangoct.py,sha256=U-9WGxfiMg7C2m2PqmXrmyMBcoRUjOw48wDy3zTXgGk,10973
+crip/lowdose.py,sha256=-rxNVo1ohcmiOHd-6hKvwADKoDbS5MohPBjkCapuX84,2614
+crip/mangoct.py,sha256=KUucuwM9LCX9c3bbI3CxEWN1G-pINTmIrZl1j1okKr4,11032
 crip/metric.py,sha256=eI0zdTg3rc_XS0IYd-8APWLaJHlcY6yI2zJ3wdM5RQU,1431
-crip/paplot.py,sha256=jEngmlN1ZHyGRB3dGGZ8cE4cloz2gKhoMr5sej79rYE,2708
-crip/physics.py,sha256=Jizjl2mfvYnoXSzXeM_NJyka9biQlMJm7IAIIRIefKU,13451
-crip/postprocess.py,sha256=EXdFnwJst8FTRC5shKdPcnuXrTD7uq7D7tL_1r_EObk,3789
-crip/preprocess.py,sha256=sduISnNDx-XzwA1kmoFw7tTq_Lg1HEF946bvkwwZUWg,6653
+crip/paplot.py,sha256=p356eMqoAZtANfIFOezKq_4tmfef0AJM_o8w1SBoiDA,2702
+crip/physics.py,sha256=G7HfFbkfkeD3b-gWCfZJQqVGoziUIMltM_JR74prCjc,13593
+crip/postprocess.py,sha256=hSyBE9BUfV_PjlFLkaeM0BHrowrLX7dZDf3ilFOZ4L8,3724
+crip/preprocess.py,sha256=lOTR8TNoZyEDu5C1oVj2Cf9x5W4es3ix1nQT_oRq_CE,8211
 crip/shared.py,sha256=uMmBtyZkCmPudsYZlFqupsB9n6QVXpVAm620luFvCC4,6678
 crip/utils.py,sha256=ZRbfg9UaXQcgaAYi7veOqg7QD9byDbJ67TV8he8KnLk,5528
 crip/_atten/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 crip/_atten/_attenList.json,sha256=M1Up8UUp0KGdCX3_NWVweCTB3ZBDiR51r_5xNdetMeE,1304
 crip/_atten/_classicRho.json,sha256=kRwqXC7empNwsSMJJPfx8QRtkHS71M2TG_Pd1Oe5Qog,548
 crip/_atten/_updateList.py,sha256=3nYGpN3-yRo1oMMjHA15nzWNR8xXwzazEMh5cuUGcuI,627
 crip/_atten/compound/CaF2.txt,sha256=Z-AdXrL2xAuJvYNYI47PvB_-F9qtznHDNJuZp0e2Aq8,592
@@ -100,12 +100,12 @@
 crip/_atten/simple/Ni.txt,sha256=5S8dxRCTgQsTxD3RkPjb_YpRJGc-wduH_x2JJqz2tPc,922
 crip/_atten/simple/O.txt,sha256=-r6uX2Vf-lYjprVMJWMGhtSxh9TLUvj12sdvWZuCt9U,823
 crip/_atten/simple/P.txt,sha256=HtQ4uYZwexG7thBcLvDk2BuE60G3nt2CWrHOGe7qE_8,691
 crip/_atten/simple/S.txt,sha256=aFgIQ8PMzmhJsa4fwQMtj9x2gDSIRKsYT7b91OgfueY,691
 crip/_atten/simple/Si.txt,sha256=co_6iJLCXZdprevjyFxzWTciETYXNIWbEsoAyxTNkU8,823
 crip/_atten/simple/Sn.txt,sha256=mA3ifgpRmP9OA4A9LdTwgItrUJuLq8xR8qV7G0RpXz4,526
 crip/_atten/simple/Ti_ICRP.txt,sha256=Fu_F3FqJ7Ym253puOuyT-4Isims_g8U7xmJWjxE-GDM,652928
-crip-1.6.1.dist-info/LICENSE,sha256=_rwEaI2Dwbuo9A5DAFjEM8es8P3CyRGJSryEvjZxe9Q,1052
-crip-1.6.1.dist-info/METADATA,sha256=frjhKCBSsAexaK1soGzwosKrqY2x7u8H_unjsEOSye8,526
-crip-1.6.1.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-crip-1.6.1.dist-info/top_level.txt,sha256=hoeB5IVBFjWadPtRY1-Zg9csrS7n058Tb3nGFY2pfu8,5
-crip-1.6.1.dist-info/RECORD,,
+crip-1.6.3.dist-info/LICENSE,sha256=_rwEaI2Dwbuo9A5DAFjEM8es8P3CyRGJSryEvjZxe9Q,1052
+crip-1.6.3.dist-info/METADATA,sha256=CjNwL6w5FEZ2NgVcX85tDhQ3WCz_i3BI91pQnBt2w5g,526
+crip-1.6.3.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+crip-1.6.3.dist-info/top_level.txt,sha256=hoeB5IVBFjWadPtRY1-Zg9csrS7n058Tb3nGFY2pfu8,5
+crip-1.6.3.dist-info/RECORD,,
```

